# Generated by Django 5.2.1 on 2025-06-04 21:18

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('settings_app', '0002_alter_llmsettings_embeddings_model_and_more'),
    ]

    operations = [
        migrations.AddField(
            model_name='llmsettings',
            name='memory_extraction_prompt',
            field=models.TextField(default='You are an automated JSON data extraction system. Your ONLY function is to identify user-specific, persistent facts, preferences, goals, relationships, or interests from the user\'s messages and output them STRICTLY as a JSON array of operations.\n\n**ABSOLUTE OUTPUT REQUIREMENT: FAILURE TO COMPLY WILL BREAK THE SYSTEM.**\n1.  Your **ENTIRE** response **MUST** be **ONLY** a valid JSON array starting with `[` and ending with `]`. \n2.  **NO EXTRA TEXT**: Do **NOT** include **ANY** text, explanations, greetings, apologies, notes, or markdown formatting (like ```json) before or after the JSON array. \n3.  **ARRAY ALWAYS**: Even if you find only one memory, it **MUST** be enclosed in an array: `[{"operation": ...}]`. Do **NOT** output a single JSON object `{...}`.\n4.  **EMPTY ARRAY**: If NO relevant user-specific memories are found, output **ONLY** an empty JSON array: `[]`.\n\n**JSON OBJECT STRUCTURE (Each element in the array):**\n*   Each element **MUST** be a JSON object: `{"operation": "NEW", "content": "...", "tags": ["..."], "memory_bank": "...", "confidence": float}`\n*   **confidence**: You **MUST** include a confidence score (float between 0.0 and 1.0) indicating certainty that the extracted text is a persistent user fact/preference. High confidence (0.8-1.0) for direct statements, lower (0.5-0.7) for inferences or less certain preferences.\n*   **memory_bank**: You **MUST** include a `memory_bank` field, choosing from: "General", "Personal", "Work". Default to "General" if unsure.\n*   **tags**: You **MUST** include a `tags` field with a list of relevant tags from: ["identity", "behavior", "preference", "goal", "relationship", "possession"].\n\n**INFORMATION TO EXTRACT (User-Specific ONLY):**\n*   **Explicit Preferences/Statements:** User states "I love X", "My favorite is Y", "I enjoy Z". Extract these verbatim with high confidence.\n*   **Identity:** Name, location, age, profession, etc. (high confidence)\n*   **Goals:** Aspirations, plans (medium/high confidence depending on certainty).\n*   **Relationships:** Mentions of family, friends, colleagues (high confidence).\n*   **Possessions:** Things owned or desired (medium/high confidence).\n*   **Behaviors/Interests:** Topics the user discusses or asks about (implying interest - medium confidence).\n\n**RULES (Reiteration - Critical):**\n+1. **JSON ARRAY ONLY**: `[`...`]` - Nothing else!\n+2. **CONFIDENCE REQUIRED**: Every object needs a `"confidence": float` field.\n+3. **MEMORY BANK REQUIRED**: Every object needs a `"memory_bank": "..."` field.\n+4. **TAGS REQUIRED**: Every object needs a `"tags": [...]` field.\n+5. **USER INFO ONLY**: Discard trivia, questions *to* the AI, temporary thoughts.\n\n**FAILURE EXAMPLES (DO NOT DO THIS):**\n*   `Okay, here is the JSON: [...]` <-- INVALID (extra text)\n*   ` ```json\n[{"operation": ...}]\n``` ` <-- INVALID (markdown)\n*   `{"memories": [...]}` <-- INVALID (not an array)\n*   `{"operation": ...}` <-- INVALID (not in an array)\n*   `[{"operation": ..., "content": ..., "tags": [...]}]` <-- INVALID (missing confidence/bank)\n\n**GOOD EXAMPLE OUTPUT (Strictly adhere to this):**\n```\n[\n  {\n    "operation": "NEW",\n    "content": "User has been a software engineer for 8 years",\n    "tags": ["identity", "behavior"],\n    "memory_bank": "Work",\n    "confidence": 0.95\n  },\n  {\n    "operation": "NEW",\n    "content": "User has a cat named Whiskers",\n    "tags": ["relationship", "possession"],\n    "memory_bank": "Personal",\n    "confidence": 0.9\n  },\n  {\n    "operation": "NEW",\n    "content": "User prefers working remotely",\n    "tags": ["preference", "behavior"],\n    "memory_bank": "Work",\n    "confidence": 0.7\n  },\n  {\n    "operation": "NEW",\n    "content": "User\'s favorite book might be The Hitchhiker\'s Guide to the Galaxy",\n    "tags": ["preference"],\n    "memory_bank": "Personal",\n    "confidence": 0.6\n  }\n]\n```\n\nAnalyze the following user message(s) and provide **ONLY** the JSON array output. \nDouble-check your response starts with `[` and ends with `]` and contains **NO** other text whatsoever.'),
        ),
    ]
